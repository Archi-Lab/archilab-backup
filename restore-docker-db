#!/usr/bin/env bash

host_name="$1"
stack_name="$2"
service_name="$3"
db_user="$4"
db_name="$5"
backup_date="$6"

scp restore-docker-db-dump "${host_name}:~/bin"

ssh "${host_name}" "[ -d backup ] || mkdir backup"

scp -3 "archilab-nas:~/backup/${service_name}_${backup_date}.sql" "${host_name}:~/backup/"

ssh "${host_name}" ~/bin/restore-docker-db-dump "${stack_name}" "${service_name}" "${db_user}" "${db_name}" "${backup_date}"

ssh "${host_name}" "rm ~/backup/*"
